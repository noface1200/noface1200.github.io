<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Repo Count Leaderboard</title>
</head>
<body>
    <ul id="leaderboard"></ul>
    <p id="message">Fetching data...</p>

    <script>
        // Function to get URL parameter
        function getParameterByName(name) {
            const url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
            const results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // Get GitHub usernames from URL (comma separated)
        const usernames = getParameterByName('user');
        
        if (usernames) {
            const userArray = usernames.split(',');
            const userPromises = userArray.map(username => {
                console.log(`Fetching data for ${username.trim()}`);
                return fetch(`https://api.github.com/users/${username.trim()}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok ' + response.statusText);
                        }
                        return response.json();
                    })
                    .then(data => ({
                        username: username.trim(),
                        public_repos: data.public_repos
                    }))
                    .catch(error => ({
                        username: username.trim(),
                        public_repos: null,
                        error: error.message
                    }));
            });

            Promise.all(userPromises).then(results => {
                console.log('Results:', results);
                results.sort((a, b) => (b.public_repos || 0) - (a.public_repos || 0));
                
                const leaderboard = document.getElementById('leaderboard');
                leaderboard.innerHTML = results.map(user => {
                    if (user.public_repos !== null) {
                        return `<li>${user.username}: ${user.public_repos} public repositories</li>`;
                    } else {
                        return `<li>${user.username}: Error fetching data (${user.error})</li>`;
                    }
                }).join('');

                document.getElementById('message').innerText = '';
            });
        } else {
            document.getElementById('message').innerText = 'No users specified in the URL parameters.';
        }
    </script>
</body>
</html>
